# Podman-compatible compose file for Risk Assistant
# Run from project root: podman-compose -f infrastructure/compose.yaml up -d

services:
  backend:
    build:
      context: ..
      dockerfile: infrastructure/backend.Dockerfile
    container_name: risk-assistant-backend
    volumes:
      # Mount model, systems, and tools for development
      - ../model:/app/model:ro
      - ../systems:/app/systems:rw
      - ../tools:/app/tools:ro
    ports:
      - "8000:8000"
    environment:
      - PYTHONUNBUFFERED=1
    networks:
      - risk-assistant
    # Backend is primarily called via API routes, not standalone
    # Comment out command if running as standalone FastAPI server
    command: ["python", "tools/riskctl.py", "--help"]

  frontend:
    build:
      context: ../web
      dockerfile: ../infrastructure/frontend.Dockerfile
    container_name: risk-assistant-frontend
    depends_on:
      - backend
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
      - NEXT_TELEMETRY_DISABLED=1
    networks:
      - risk-assistant

networks:
  risk-assistant:
    driver: bridge
